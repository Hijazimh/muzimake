<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 3 - Contact Details | Muzimake v3</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="media/logo-icon-black.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/logo-icon-black.png">
    <link rel="apple-touch-icon" sizes="180x180" href="media/logo-icon-white.png">
    <link rel="icon" type="image/png" sizes="192x192" href="media/logo-icon-black.png">
    <link rel="icon" type="image/png" sizes="512x512" href="media/logo-icon-black.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/libphonenumber-js@1.10.58/bundle/libphonenumber-js.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-blue': '#3B82F6',
                        'custom-dark': '#262420',
                        'custom-gray': '#54524c',
                        'custom-beige': '#f3f1eb'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        .font-inter {
            font-family: 'Inter', sans-serif;
        }
        
        .font-extrabold {
            font-weight: 800;
        }
        
        .font-black {
            font-weight: 900;
        }
        
        .nav-link {
            transition: color 0.3s ease;
        }
        
        /* Mobile menu styles */
        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .mobile-menu.open {
            display: block;
        }
        
        .mobile-menu a {
            display: block;
            padding: 0.75rem 0;
            color: #232321;
            text-decoration: none;
            font-weight: 500;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .mobile-menu a:last-child {
            border-bottom: none;
            margin-top: 0.5rem;
        }
        
        /* Burger menu button */
        .burger-menu {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .burger-menu span {
            width: 25px;
            height: 3px;
            background-color: #232321;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }
        
        .burger-menu.open span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }
        
        .burger-menu.open span:nth-child(2) {
            opacity: 0;
        }
        
        .burger-menu.open span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }
        
        @media (max-width: 768px) {
            .burger-menu {
                display: flex;
            }
            
            .nav-links {
                display: none;
            }
        }
        
        .form-input {
            border: 1px solid #e1ded6;
            border-radius: 3px;
            padding: 12px 18px;
            font-size: 15px;
            color: #262420;
            background-color: white;
            transition: border-color 0.2s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #262420;
            color: #262420;
        }
        
        .form-input::placeholder {
            color: #54524c;
        }
        
        .form-input.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 1px #ef4444;
        }
        
        .form-input.valid {
            border-color: #10b981;
            box-shadow: 0 0 0 1px #10b981;
        }
        
        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 4px;
        }
        
        /* Modal styles */
        .modal-overlay {
            backdrop-filter: blur(2px);
            background-color: rgba(0, 0, 0, 0.3);
        }
        
        .modal-content {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Button states */
        .next-button-active {
            background-color: #262420;
            color: white;
        }
        
        .next-button-inactive {
            background-color: rgba(38, 36, 32, 0.12);
            color: #232321;
            opacity: 0.38;
        }
    </style>
</head>
<body class="bg-custom-beige font-inter">

    <!-- Navigation -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-md z-50 h-20 shadow-sm">
        <div class="max-w-7xl mx-auto px-8 h-full flex items-center justify-between relative">
            <!-- Logo -->
            <div class="h-12 w-40">
                <a href="index.html">
                    <img id="logo" src="media/logo-horiz-black.png" alt="Muzimake" class="h-full w-full object-contain">
                </a>
            </div>
            
            <!-- Desktop Navigation Links -->
            <div class="nav-links hidden md:flex items-center space-x-8">
                <a href="how-it-works.html" class="text-custom-dark text-base font-medium hover:text-custom-orange transition-colors nav-link">How it works</a>
            </div>
            
            <!-- Mobile Burger Menu -->
            <div class="burger-menu md:hidden" id="burgerMenu">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <!-- Mobile Menu -->
            <div class="mobile-menu" id="mobileMenu">
                <a href="how-it-works.html" class="nav-link">How it works</a>
            </div>
        </div>
    </nav>

    <!-- Sticky Progress Indicator -->
    <div class="fixed top-20 left-0 right-0 bg-custom-beige/60 backdrop-blur-sm z-40">
        <div class="max-w-2xl mx-auto px-8 py-4">
            <div class="text-center relative">
                <div class="inline-flex items-center border border-gray-300 rounded-full px-4 py-2 bg-white">
                    <span class="text-custom-dark text-xs font-bold tracking-wider uppercase">Step 3 of 4</span>
                </div>
                <button id="backBtn" class="absolute left-0 top-0 w-6 h-6">
                    <img src="media/back-button-small.svg" alt="Back" class="w-full h-full">
                </button>
                <button id="closeBtn" class="absolute right-0 top-0 w-6 h-6">
                    <img src="media/close-button-small.svg" alt="Close" class="w-full h-full">
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="pt-40 pb-20">
        <div class="max-w-2xl mx-auto px-8">

            <!-- Form Container -->
            <div class="p-8">
                <!-- Header -->
                <div class="text-center mb-12">
                    <h1 class="text-custom-dark text-3xl font-bold leading-tight">
                        Your contact details
                    </h1>
                </div>

                <!-- Form Fields -->
                <div class="space-y-6">
                    <!-- Full Name -->
                    <div>
                        <label class="block text-custom-gray text-xs font-bold tracking-wider uppercase mb-2">
                            Full name*
                        </label>
                        <input type="text" id="fullName" name="fullName" class="form-input w-full" placeholder="your full name">
                        <div id="nameError" class="error-message hidden"></div>
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-custom-gray text-xs font-bold tracking-wider uppercase mb-2">
                            Enter your email*
                        </label>
                        <input type="email" id="email" name="email" class="form-input w-full" placeholder="email">
                        <div id="emailError" class="error-message hidden"></div>
                    </div>

                    <!-- Phone Number -->
                    <div>
                        <label class="block text-custom-gray text-xs font-bold tracking-wider uppercase mb-2">
                            Enter your Whatsapp phone number*
                        </label>
                        <div class="flex gap-2">
                            <div class="relative w-32">
                                <select id="countryCode" name="countryCode" class="form-input w-full appearance-none pr-8 text-sm">
                                    <option value="+93" data-country="AF">ðŸ‡¦ðŸ‡« Afghanistan (+93)</option>
                                    <option value="+355" data-country="AL">ðŸ‡¦ðŸ‡± Albania (+355)</option>
                                    <option value="+213" data-country="DZ">ðŸ‡©ðŸ‡¿ Algeria (+213)</option>
                                    <option value="+376" data-country="AD">ðŸ‡¦ðŸ‡© Andorra (+376)</option>
                                    <option value="+244" data-country="AO">ðŸ‡¦ðŸ‡´ Angola (+244)</option>
                                    <option value="+1" data-country="AG">ðŸ‡¦ðŸ‡¬ Antigua and Barbuda (+1)</option>
                                    <option value="+54" data-country="AR">ðŸ‡¦ðŸ‡· Argentina (+54)</option>
                                    <option value="+374" data-country="AM">ðŸ‡¦ðŸ‡² Armenia (+374)</option>
                                    <option value="+61" data-country="AU">ðŸ‡¦ðŸ‡º Australia (+61)</option>
                                    <option value="+43" data-country="AT">ðŸ‡¦ðŸ‡¹ Austria (+43)</option>
                                    <option value="+994" data-country="AZ">ðŸ‡¦ðŸ‡¿ Azerbaijan (+994)</option>
                                    <option value="+1" data-country="BS">ðŸ‡§ðŸ‡¸ Bahamas (+1)</option>
                                    <option value="+973" data-country="BH">ðŸ‡§ðŸ‡­ Bahrain (+973)</option>
                                    <option value="+880" data-country="BD">ðŸ‡§ðŸ‡© Bangladesh (+880)</option>
                                    <option value="+1" data-country="BB">ðŸ‡§ðŸ‡§ Barbados (+1)</option>
                                    <option value="+375" data-country="BY">ðŸ‡§ðŸ‡¾ Belarus (+375)</option>
                                    <option value="+32" data-country="BE">ðŸ‡§ðŸ‡ª Belgium (+32)</option>
                                    <option value="+501" data-country="BZ">ðŸ‡§ðŸ‡¿ Belize (+501)</option>
                                    <option value="+229" data-country="BJ">ðŸ‡§ðŸ‡¯ Benin (+229)</option>
                                    <option value="+1" data-country="BM">ðŸ‡§ðŸ‡² Bermuda (+1)</option>
                                    <option value="+975" data-country="BT">ðŸ‡§ðŸ‡¹ Bhutan (+975)</option>
                                    <option value="+591" data-country="BO">ðŸ‡§ðŸ‡´ Bolivia (+591)</option>
                                    <option value="+387" data-country="BA">ðŸ‡§ðŸ‡¦ Bosnia and Herzegovina (+387)</option>
                                    <option value="+267" data-country="BW">ðŸ‡§ðŸ‡¼ Botswana (+267)</option>
                                    <option value="+55" data-country="BR">ðŸ‡§ðŸ‡· Brazil (+55)</option>
                                    <option value="+673" data-country="BN">ðŸ‡§ðŸ‡³ Brunei (+673)</option>
                                    <option value="+359" data-country="BG">ðŸ‡§ðŸ‡¬ Bulgaria (+359)</option>
                                    <option value="+226" data-country="BF">ðŸ‡§ðŸ‡« Burkina Faso (+226)</option>
                                    <option value="+257" data-country="BI">ðŸ‡§ðŸ‡® Burundi (+257)</option>
                                    <option value="+855" data-country="KH">ðŸ‡°ðŸ‡­ Cambodia (+855)</option>
                                    <option value="+237" data-country="CM">ðŸ‡¨ðŸ‡² Cameroon (+237)</option>
                                    <option value="+1" data-country="CA">ðŸ‡¨ðŸ‡¦ Canada (+1)</option>
                                    <option value="+238" data-country="CV">ðŸ‡¨ðŸ‡» Cape Verde (+238)</option>
                                    <option value="+236" data-country="CF">ðŸ‡¨ðŸ‡« Central African Republic (+236)</option>
                                    <option value="+235" data-country="TD">ðŸ‡¹ðŸ‡© Chad (+235)</option>
                                    <option value="+56" data-country="CL">ðŸ‡¨ðŸ‡± Chile (+56)</option>
                                    <option value="+86" data-country="CN">ðŸ‡¨ðŸ‡³ China (+86)</option>
                                    <option value="+57" data-country="CO">ðŸ‡¨ðŸ‡´ Colombia (+57)</option>
                                    <option value="+269" data-country="KM">ðŸ‡°ðŸ‡² Comoros (+269)</option>
                                    <option value="+242" data-country="CG">ðŸ‡¨ðŸ‡¬ Congo (+242)</option>
                                    <option value="+243" data-country="CD">ðŸ‡¨ðŸ‡© Democratic Republic of the Congo (+243)</option>
                                    <option value="+506" data-country="CR">ðŸ‡¨ðŸ‡· Costa Rica (+506)</option>
                                    <option value="+225" data-country="CI">ðŸ‡¨ðŸ‡® CÃ´te d'Ivoire (+225)</option>
                                    <option value="+385" data-country="HR">ðŸ‡­ðŸ‡· Croatia (+385)</option>
                                    <option value="+53" data-country="CU">ðŸ‡¨ðŸ‡º Cuba (+53)</option>
                                    <option value="+357" data-country="CY">ðŸ‡¨ðŸ‡¾ Cyprus (+357)</option>
                                    <option value="+420" data-country="CZ">ðŸ‡¨ðŸ‡¿ Czech Republic (+420)</option>
                                    <option value="+45" data-country="DK">ðŸ‡©ðŸ‡° Denmark (+45)</option>
                                    <option value="+253" data-country="DJ">ðŸ‡©ðŸ‡¯ Djibouti (+253)</option>
                                    <option value="+1" data-country="DM">ðŸ‡©ðŸ‡² Dominica (+1)</option>
                                    <option value="+1" data-country="DO">ðŸ‡©ðŸ‡´ Dominican Republic (+1)</option>
                                    <option value="+593" data-country="EC">ðŸ‡ªðŸ‡¨ Ecuador (+593)</option>
                                    <option value="+20" data-country="EG">ðŸ‡ªðŸ‡¬ Egypt (+20)</option>
                                    <option value="+503" data-country="SV">ðŸ‡¸ðŸ‡» El Salvador (+503)</option>
                                    <option value="+240" data-country="GQ">ðŸ‡¬ðŸ‡¶ Equatorial Guinea (+240)</option>
                                    <option value="+291" data-country="ER">ðŸ‡ªðŸ‡· Eritrea (+291)</option>
                                    <option value="+372" data-country="EE">ðŸ‡ªðŸ‡ª Estonia (+372)</option>
                                    <option value="+251" data-country="ET">ðŸ‡ªðŸ‡¹ Ethiopia (+251)</option>
                                    <option value="+679" data-country="FJ">ðŸ‡«ðŸ‡¯ Fiji (+679)</option>
                                    <option value="+358" data-country="FI">ðŸ‡«ðŸ‡® Finland (+358)</option>
                                    <option value="+33" data-country="FR">ðŸ‡«ðŸ‡· France (+33)</option>
                                    <option value="+241" data-country="GA">ðŸ‡¬ðŸ‡¦ Gabon (+241)</option>
                                    <option value="+220" data-country="GM">ðŸ‡¬ðŸ‡² Gambia (+220)</option>
                                    <option value="+995" data-country="GE">ðŸ‡¬ðŸ‡ª Georgia (+995)</option>
                                    <option value="+49" data-country="DE">ðŸ‡©ðŸ‡ª Germany (+49)</option>
                                    <option value="+233" data-country="GH">ðŸ‡¬ðŸ‡­ Ghana (+233)</option>
                                    <option value="+350" data-country="GI">ðŸ‡¬ðŸ‡® Gibraltar (+350)</option>
                                    <option value="+30" data-country="GR">ðŸ‡¬ðŸ‡· Greece (+30)</option>
                                    <option value="+299" data-country="GL">ðŸ‡¬ðŸ‡± Greenland (+299)</option>
                                    <option value="+1" data-country="GD">ðŸ‡¬ðŸ‡© Grenada (+1)</option>
                                    <option value="+590" data-country="GP">ðŸ‡¬ðŸ‡µ Guadeloupe (+590)</option>
                                    <option value="+1" data-country="GU">ðŸ‡¬ðŸ‡º Guam (+1)</option>
                                    <option value="+502" data-country="GT">ðŸ‡¬ðŸ‡¹ Guatemala (+502)</option>
                                    <option value="+224" data-country="GN">ðŸ‡¬ðŸ‡³ Guinea (+224)</option>
                                    <option value="+245" data-country="GW">ðŸ‡¬ðŸ‡¼ Guinea-Bissau (+245)</option>
                                    <option value="+592" data-country="GY">ðŸ‡¬ðŸ‡¾ Guyana (+592)</option>
                                    <option value="+509" data-country="HT">ðŸ‡­ðŸ‡¹ Haiti (+509)</option>
                                    <option value="+504" data-country="HN">ðŸ‡­ðŸ‡³ Honduras (+504)</option>
                                    <option value="+852" data-country="HK">ðŸ‡­ðŸ‡° Hong Kong (+852)</option>
                                    <option value="+36" data-country="HU">ðŸ‡­ðŸ‡º Hungary (+36)</option>
                                    <option value="+354" data-country="IS">ðŸ‡®ðŸ‡¸ Iceland (+354)</option>
                                    <option value="+91" data-country="IN">ðŸ‡®ðŸ‡³ India (+91)</option>
                                    <option value="+62" data-country="ID">ðŸ‡®ðŸ‡© Indonesia (+62)</option>
                                    <option value="+98" data-country="IR">ðŸ‡®ðŸ‡· Iran (+98)</option>
                                    <option value="+964" data-country="IQ">ðŸ‡®ðŸ‡¶ Iraq (+964)</option>
                                    <option value="+353" data-country="IE">ðŸ‡®ðŸ‡ª Ireland (+353)</option>
                                    <option value="+972" data-country="IL">ðŸ‡®ðŸ‡± Israel (+972)</option>
                                    <option value="+39" data-country="IT">ðŸ‡®ðŸ‡¹ Italy (+39)</option>
                                    <option value="+1" data-country="JM">ðŸ‡¯ðŸ‡² Jamaica (+1)</option>
                                    <option value="+81" data-country="JP">ðŸ‡¯ðŸ‡µ Japan (+81)</option>
                                    <option value="+962" data-country="JO">ðŸ‡¯ðŸ‡´ Jordan (+962)</option>
                                    <option value="+7" data-country="KZ">ðŸ‡°ðŸ‡¿ Kazakhstan (+7)</option>
                                    <option value="+254" data-country="KE">ðŸ‡°ðŸ‡ª Kenya (+254)</option>
                                    <option value="+686" data-country="KI">ðŸ‡°ðŸ‡® Kiribati (+686)</option>
                                    <option value="+850" data-country="KP">ðŸ‡°ðŸ‡µ North Korea (+850)</option>
                                    <option value="+82" data-country="KR">ðŸ‡°ðŸ‡· South Korea (+82)</option>
                                    <option value="+965" data-country="KW">ðŸ‡°ðŸ‡¼ Kuwait (+965)</option>
                                    <option value="+996" data-country="KG">ðŸ‡°ðŸ‡¬ Kyrgyzstan (+996)</option>
                                    <option value="+856" data-country="LA">ðŸ‡±ðŸ‡¦ Laos (+856)</option>
                                    <option value="+371" data-country="LV">ðŸ‡±ðŸ‡» Latvia (+371)</option>
                                    <option value="+961" data-country="LB">ðŸ‡±ðŸ‡§ Lebanon (+961)</option>
                                    <option value="+266" data-country="LS">ðŸ‡±ðŸ‡¸ Lesotho (+266)</option>
                                    <option value="+231" data-country="LR">ðŸ‡±ðŸ‡· Liberia (+231)</option>
                                    <option value="+218" data-country="LY">ðŸ‡±ðŸ‡¾ Libya (+218)</option>
                                    <option value="+423" data-country="LI">ðŸ‡±ðŸ‡® Liechtenstein (+423)</option>
                                    <option value="+370" data-country="LT">ðŸ‡±ðŸ‡¹ Lithuania (+370)</option>
                                    <option value="+352" data-country="LU">ðŸ‡±ðŸ‡º Luxembourg (+352)</option>
                                    <option value="+853" data-country="MO">ðŸ‡²ðŸ‡´ Macau (+853)</option>
                                    <option value="+389" data-country="MK">ðŸ‡²ðŸ‡° North Macedonia (+389)</option>
                                    <option value="+261" data-country="MG">ðŸ‡²ðŸ‡¬ Madagascar (+261)</option>
                                    <option value="+265" data-country="MW">ðŸ‡²ðŸ‡¼ Malawi (+265)</option>
                                    <option value="+60" data-country="MY">ðŸ‡²ðŸ‡¾ Malaysia (+60)</option>
                                    <option value="+960" data-country="MV">ðŸ‡²ðŸ‡» Maldives (+960)</option>
                                    <option value="+223" data-country="ML">ðŸ‡²ðŸ‡± Mali (+223)</option>
                                    <option value="+356" data-country="MT">ðŸ‡²ðŸ‡¹ Malta (+356)</option>
                                    <option value="+692" data-country="MH">ðŸ‡²ðŸ‡­ Marshall Islands (+692)</option>
                                    <option value="+596" data-country="MQ">ðŸ‡²ðŸ‡¶ Martinique (+596)</option>
                                    <option value="+222" data-country="MR">ðŸ‡²ðŸ‡· Mauritania (+222)</option>
                                    <option value="+230" data-country="MU">ðŸ‡²ðŸ‡º Mauritius (+230)</option>
                                    <option value="+262" data-country="YT">ðŸ‡¾ðŸ‡¹ Mayotte (+262)</option>
                                    <option value="+52" data-country="MX">ðŸ‡²ðŸ‡½ Mexico (+52)</option>
                                    <option value="+691" data-country="FM">ðŸ‡«ðŸ‡² Micronesia (+691)</option>
                                    <option value="+373" data-country="MD">ðŸ‡²ðŸ‡© Moldova (+373)</option>
                                    <option value="+377" data-country="MC">ðŸ‡²ðŸ‡¨ Monaco (+377)</option>
                                    <option value="+976" data-country="MN">ðŸ‡²ðŸ‡³ Mongolia (+976)</option>
                                    <option value="+382" data-country="ME">ðŸ‡²ðŸ‡ª Montenegro (+382)</option>
                                    <option value="+1" data-country="MS">ðŸ‡²ðŸ‡¸ Montserrat (+1)</option>
                                    <option value="+212" data-country="MA">ðŸ‡²ðŸ‡¦ Morocco (+212)</option>
                                    <option value="+258" data-country="MZ">ðŸ‡²ðŸ‡¿ Mozambique (+258)</option>
                                    <option value="+95" data-country="MM">ðŸ‡²ðŸ‡² Myanmar (+95)</option>
                                    <option value="+264" data-country="NA">ðŸ‡³ðŸ‡¦ Namibia (+264)</option>
                                    <option value="+674" data-country="NR">ðŸ‡³ðŸ‡· Nauru (+674)</option>
                                    <option value="+977" data-country="NP">ðŸ‡³ðŸ‡µ Nepal (+977)</option>
                                    <option value="+31" data-country="NL">ðŸ‡³ðŸ‡± Netherlands (+31)</option>
                                    <option value="+687" data-country="NC">ðŸ‡³ðŸ‡¨ New Caledonia (+687)</option>
                                    <option value="+64" data-country="NZ">ðŸ‡³ðŸ‡¿ New Zealand (+64)</option>
                                    <option value="+505" data-country="NI">ðŸ‡³ðŸ‡® Nicaragua (+505)</option>
                                    <option value="+227" data-country="NE">ðŸ‡³ðŸ‡ª Niger (+227)</option>
                                    <option value="+234" data-country="NG">ðŸ‡³ðŸ‡¬ Nigeria (+234)</option>
                                    <option value="+683" data-country="NU">ðŸ‡³ðŸ‡º Niue (+683)</option>
                                    <option value="+672" data-country="NF">ðŸ‡³ðŸ‡« Norfolk Island (+672)</option>
                                    <option value="+1" data-country="MP">ðŸ‡²ðŸ‡µ Northern Mariana Islands (+1)</option>
                                    <option value="+47" data-country="NO">ðŸ‡³ðŸ‡´ Norway (+47)</option>
                                    <option value="+968" data-country="OM">ðŸ‡´ðŸ‡² Oman (+968)</option>
                                    <option value="+92" data-country="PK">ðŸ‡µðŸ‡° Pakistan (+92)</option>
                                    <option value="+680" data-country="PW">ðŸ‡µðŸ‡¼ Palau (+680)</option>
                                    <option value="+970" data-country="PS">ðŸ‡µðŸ‡¸ Palestine (+970)</option>
                                    <option value="+507" data-country="PA">ðŸ‡µðŸ‡¦ Panama (+507)</option>
                                    <option value="+675" data-country="PG">ðŸ‡µðŸ‡¬ Papua New Guinea (+675)</option>
                                    <option value="+595" data-country="PY">ðŸ‡µðŸ‡¾ Paraguay (+595)</option>
                                    <option value="+51" data-country="PE">ðŸ‡µðŸ‡ª Peru (+51)</option>
                                    <option value="+63" data-country="PH">ðŸ‡µðŸ‡­ Philippines (+63)</option>
                                    <option value="+48" data-country="PL">ðŸ‡µðŸ‡± Poland (+48)</option>
                                    <option value="+351" data-country="PT">ðŸ‡µðŸ‡¹ Portugal (+351)</option>
                                    <option value="+1" data-country="PR">ðŸ‡µðŸ‡· Puerto Rico (+1)</option>
                                    <option value="+974" data-country="QA">ðŸ‡¶ðŸ‡¦ Qatar (+974)</option>
                                    <option value="+262" data-country="RE">ðŸ‡·ðŸ‡ª RÃ©union (+262)</option>
                                    <option value="+40" data-country="RO">ðŸ‡·ðŸ‡´ Romania (+40)</option>
                                    <option value="+7" data-country="RU">ðŸ‡·ðŸ‡º Russia (+7)</option>
                                    <option value="+250" data-country="RW">ðŸ‡·ðŸ‡¼ Rwanda (+250)</option>
                                    <option value="+290" data-country="SH">ðŸ‡¸ðŸ‡­ Saint Helena (+290)</option>
                                    <option value="+1" data-country="KN">ðŸ‡°ðŸ‡³ Saint Kitts and Nevis (+1)</option>
                                    <option value="+1" data-country="LC">ðŸ‡±ðŸ‡¨ Saint Lucia (+1)</option>
                                    <option value="+508" data-country="PM">ðŸ‡µðŸ‡² Saint Pierre and Miquelon (+508)</option>
                                    <option value="+1" data-country="VC">ðŸ‡»ðŸ‡¨ Saint Vincent and the Grenadines (+1)</option>
                                    <option value="+685" data-country="WS">ðŸ‡¼ðŸ‡¸ Samoa (+685)</option>
                                    <option value="+378" data-country="SM">ðŸ‡¸ðŸ‡² San Marino (+378)</option>
                                    <option value="+239" data-country="ST">ðŸ‡¸ðŸ‡¹ SÃ£o TomÃ© and PrÃ­ncipe (+239)</option>
                                    <option value="+966" data-country="SA">ðŸ‡¸ðŸ‡¦ Saudi Arabia (+966)</option>
                                    <option value="+221" data-country="SN">ðŸ‡¸ðŸ‡³ Senegal (+221)</option>
                                    <option value="+381" data-country="RS">ðŸ‡·ðŸ‡¸ Serbia (+381)</option>
                                    <option value="+248" data-country="SC">ðŸ‡¸ðŸ‡¨ Seychelles (+248)</option>
                                    <option value="+232" data-country="SL">ðŸ‡¸ðŸ‡± Sierra Leone (+232)</option>
                                    <option value="+65" data-country="SG">ðŸ‡¸ðŸ‡¬ Singapore (+65)</option>
                                    <option value="+421" data-country="SK">ðŸ‡¸ðŸ‡° Slovakia (+421)</option>
                                    <option value="+386" data-country="SI">ðŸ‡¸ðŸ‡® Slovenia (+386)</option>
                                    <option value="+677" data-country="SB">ðŸ‡¸ðŸ‡§ Solomon Islands (+677)</option>
                                    <option value="+252" data-country="SO">ðŸ‡¸ðŸ‡´ Somalia (+252)</option>
                                    <option value="+27" data-country="ZA">ðŸ‡¿ðŸ‡¦ South Africa (+27)</option>
                                    <option value="+34" data-country="ES">ðŸ‡ªðŸ‡¸ Spain (+34)</option>
                                    <option value="+94" data-country="LK">ðŸ‡±ðŸ‡° Sri Lanka (+94)</option>
                                    <option value="+249" data-country="SD">ðŸ‡¸ðŸ‡© Sudan (+249)</option>
                                    <option value="+597" data-country="SR">ðŸ‡¸ðŸ‡· Suriname (+597)</option>
                                    <option value="+268" data-country="SZ">ðŸ‡¸ðŸ‡¿ Eswatini (+268)</option>
                                    <option value="+46" data-country="SE">ðŸ‡¸ðŸ‡ª Sweden (+46)</option>
                                    <option value="+41" data-country="CH">ðŸ‡¨ðŸ‡­ Switzerland (+41)</option>
                                    <option value="+963" data-country="SY">ðŸ‡¸ðŸ‡¾ Syria (+963)</option>
                                    <option value="+886" data-country="TW">ðŸ‡¹ðŸ‡¼ Taiwan (+886)</option>
                                    <option value="+992" data-country="TJ">ðŸ‡¹ðŸ‡¯ Tajikistan (+992)</option>
                                    <option value="+255" data-country="TZ">ðŸ‡¹ðŸ‡¿ Tanzania (+255)</option>
                                    <option value="+66" data-country="TH">ðŸ‡¹ðŸ‡­ Thailand (+66)</option>
                                    <option value="+670" data-country="TL">ðŸ‡¹ðŸ‡± Timor-Leste (+670)</option>
                                    <option value="+228" data-country="TG">ðŸ‡¹ðŸ‡¬ Togo (+228)</option>
                                    <option value="+690" data-country="TK">ðŸ‡¹ðŸ‡° Tokelau (+690)</option>
                                    <option value="+676" data-country="TO">ðŸ‡¹ðŸ‡´ Tonga (+676)</option>
                                    <option value="+1" data-country="TT">ðŸ‡¹ðŸ‡¹ Trinidad and Tobago (+1)</option>
                                    <option value="+216" data-country="TN">ðŸ‡¹ðŸ‡³ Tunisia (+216)</option>
                                    <option value="+90" data-country="TR">ðŸ‡¹ðŸ‡· Turkey (+90)</option>
                                    <option value="+993" data-country="TM">ðŸ‡¹ðŸ‡² Turkmenistan (+993)</option>
                                    <option value="+1" data-country="TC">ðŸ‡¹ðŸ‡¨ Turks and Caicos Islands (+1)</option>
                                    <option value="+688" data-country="TV">ðŸ‡¹ðŸ‡» Tuvalu (+688)</option>
                                    <option value="+256" data-country="UG">ðŸ‡ºðŸ‡¬ Uganda (+256)</option>
                                    <option value="+380" data-country="UA">ðŸ‡ºðŸ‡¦ Ukraine (+380)</option>
                                    <option value="+971" data-country="AE">ðŸ‡¦ðŸ‡ª United Arab Emirates (+971)</option>
                                    <option value="+44" data-country="GB">ðŸ‡¬ðŸ‡§ United Kingdom (+44)</option>
                                    <option value="+1" data-country="US">ðŸ‡ºðŸ‡¸ United States (+1)</option>
                                    <option value="+598" data-country="UY">ðŸ‡ºðŸ‡¾ Uruguay (+598)</option>
                                    <option value="+998" data-country="UZ">ðŸ‡ºðŸ‡¿ Uzbekistan (+998)</option>
                                    <option value="+678" data-country="VU">ðŸ‡»ðŸ‡º Vanuatu (+678)</option>
                                    <option value="+39" data-country="VA">ðŸ‡»ðŸ‡¦ Vatican City (+39)</option>
                                    <option value="+58" data-country="VE">ðŸ‡»ðŸ‡ª Venezuela (+58)</option>
                                    <option value="+84" data-country="VN">ðŸ‡»ðŸ‡³ Vietnam (+84)</option>
                                    <option value="+1" data-country="VG">ðŸ‡»ðŸ‡¬ British Virgin Islands (+1)</option>
                                    <option value="+1" data-country="VI">ðŸ‡»ðŸ‡® U.S. Virgin Islands (+1)</option>
                                    <option value="+681" data-country="WF">ðŸ‡¼ðŸ‡« Wallis and Futuna (+681)</option>
                                    <option value="+212" data-country="EH">ðŸ‡ªðŸ‡­ Western Sahara (+212)</option>
                                    <option value="+967" data-country="YE">ðŸ‡¾ðŸ‡ª Yemen (+967)</option>
                                    <option value="+260" data-country="ZM">ðŸ‡¿ðŸ‡² Zambia (+260)</option>
                                    <option value="+263" data-country="ZW">ðŸ‡¿ðŸ‡¼ Zimbabwe (+263)</option>
                                </select>
                                <div class="absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                    <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                            <input type="tel" id="phoneNumber" name="phoneNumber" class="form-input flex-1" placeholder="enter number">
                        </div>
                        <div id="phoneError" class="error-message hidden"></div>
                        <div class="flex items-center gap-1 mt-2">
                            <div class="w-4 h-4">
                                <img src="media/whatsapp-logo.svg?v=2" alt="WhatsApp" class="w-full h-full">
                            </div>
                            <p class="text-custom-gray text-xs font-medium tracking-wider uppercase">
                                We will send you the song on this number
                            </p>
                        </div>
                    </div>

                    <!-- Pricing Section -->
                    <div>
                        <label class="block text-custom-gray text-xs font-bold tracking-wider uppercase mb-2">
                            Total
                        </label>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-custom-gray text-xs font-bold tracking-wider uppercase">1x Song Fee</span>
                                <span class="text-custom-gray text-lg font-bold" id="total">AED 35.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Note -->
                <div class="text-center mt-8">
                    <p class="text-custom-gray text-xs font-medium tracking-wider uppercase">
                        *Your order includes 2 revised songs. If you're not happy with the result, just let us know â€” we'll make sure to fix it until you love it.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 bg-custom-beige/60 backdrop-blur-sm shadow-lg">
        <div class="max-w-2xl mx-auto px-8 py-4">
            <div class="flex justify-center">
                <button id="nextBtn" class="next-button-inactive px-8 py-3 rounded-full font-medium transition-all duration-200 cursor-not-allowed">
                    Go to Payment
                </button>
            </div>
        </div>
    </div>

    <!-- Exit Confirmation Modal -->
    <div id="exitModal" class="fixed inset-0 modal-overlay z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content w-full max-w-md p-6">
                <!-- Modal Header -->
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-custom-gray text-lg font-bold tracking-tight">Progress will be lost</h3>
                    <button id="closeModalBtn" class="w-6 h-6">
                        <img src="media/close-button-small.svg" alt="Close" class="w-full h-full">
                    </button>
                </div>
                
                <!-- Modal Content -->
                <p class="text-custom-gray text-sm leading-relaxed mb-6">
                    If you leave this page, all your progress will be lost. Are you sure you want to continue?
                </p>
                
                <!-- Divider -->
                <div class="border-t border-gray-200 mb-6"></div>
                
                <!-- Modal Actions -->
                <div class="flex gap-4">
                    <button id="cancelExitBtn" class="flex-1 bg-custom-gray/12 text-custom-dark px-6 py-3 rounded-full font-medium hover:bg-custom-gray/20 transition-colors">
                        Cancel
                    </button>
                    <button id="confirmExitBtn" class="flex-1 bg-custom-gray text-white px-6 py-3 rounded-full font-medium hover:bg-custom-gray/90 transition-colors">
                        Leave
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu functionality
        const burgerMenu = document.getElementById('burgerMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        
        if (burgerMenu && mobileMenu) {
            burgerMenu.addEventListener('click', function() {
                this.classList.toggle('open');
                mobileMenu.classList.toggle('open');
            });
            
            // Close mobile menu when clicking on a link
            mobileMenu.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    this.classList.remove('open');
                    burgerMenu.classList.remove('open');
                }
            });
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!burgerMenu.contains(e.target) && !mobileMenu.contains(e.target)) {
                    mobileMenu.classList.remove('open');
                    burgerMenu.classList.remove('open');
                }
            });
        }

        // Price calculation
        const SONG_PRICE = 35.00; // AED

        function calculatePrices() {
            const total = SONG_PRICE;
            const totalEl = document.getElementById('total');
            if (totalEl) totalEl.textContent = `AED ${total.toFixed(2)}`;
        }

        // Form validation
        const nextBtn = document.getElementById('nextBtn');
        const fullNameInput = document.getElementById('fullName');
        const emailInput = document.getElementById('email');
        const phoneInput = document.getElementById('phoneNumber');
        const countryCodeSelect = document.getElementById('countryCode');

        // Track which fields have been touched by the user
        const touchedFields = {
            fullName: false,
            email: false,
            phone: false
        };

        // Validation functions
        function validateName(name) {
            return name.trim().length >= 2 && /^[a-zA-Z\s'-]+$/.test(name.trim());
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email.trim());
        }

        function validatePhone(phone, countryCode) {
            try {
                const fullNumber = countryCode + phone;
                const parsedNumber = libphonenumber.parsePhoneNumber(fullNumber);
                return parsedNumber && parsedNumber.isValid();
            } catch (error) {
                return false;
            }
        }

        function showError(field, errorElement, message) {
            field.classList.add('error');
            field.classList.remove('valid');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function showValid(field, errorElement) {
            field.classList.remove('error');
            field.classList.add('valid');
            errorElement.classList.add('hidden');
        }

        function clearFieldState(field, errorElement) {
            field.classList.remove('error', 'valid');
            errorElement.classList.add('hidden');
        }

        function validateField(field, errorElement, validator, errorMessage, fieldName) {
            const value = field.value.trim();
            
            // Only validate if the field has been touched by the user
            if (!touchedFields[fieldName]) {
                clearFieldState(field, errorElement);
                return value !== ''; // Return true if not empty, false if empty (for button state)
            }
            
            if (value === '') {
                showError(field, errorElement, 'This field is required');
                return false;
            } else if (!validator(value)) {
                showError(field, errorElement, errorMessage);
                return false;
            } else {
                showValid(field, errorElement);
                return true;
            }
        }

        function validatePhoneField() {
            const phoneValue = phoneInput.value.trim();
            const countryCode = countryCodeSelect.value;
            const phoneError = document.getElementById('phoneError');
            
            // Only validate if the field has been touched by the user
            if (!touchedFields.phone) {
                clearFieldState(phoneInput, phoneError);
                return phoneValue !== ''; // Return true if not empty, false if empty (for button state)
            }
            
            if (phoneValue === '') {
                showError(phoneInput, phoneError, 'Phone number is required');
                return false;
            } else if (!validatePhone(phoneValue, countryCode)) {
                showError(phoneInput, phoneError, 'Please enter a valid phone number');
                return false;
            } else {
                showValid(phoneInput, phoneError);
                return true;
            }
        }

        function updateNextButton() {
            const nameValid = validateField(fullNameInput, document.getElementById('nameError'), validateName, 'Please enter a valid name (at least 2 characters)', 'fullName');
            const emailValid = validateField(emailInput, document.getElementById('emailError'), validateEmail, 'Please enter a valid email address', 'email');
            const phoneValid = validatePhoneField();
            
            const isComplete = nameValid && emailValid && phoneValid;
            
            if (isComplete) {
                nextBtn.className = 'next-button-active px-8 py-3 rounded-full font-medium transition-all duration-200 cursor-pointer';
                nextBtn.disabled = false;
            } else {
                nextBtn.className = 'next-button-inactive px-8 py-3 rounded-full font-medium transition-all duration-200 cursor-not-allowed';
                nextBtn.disabled = true;
            }
        }

        // Add event listeners
        fullNameInput.addEventListener('input', updateNextButton);
        emailInput.addEventListener('input', updateNextButton);
        phoneInput.addEventListener('input', updateNextButton);
        countryCodeSelect.addEventListener('change', updateNextButton);

        // Track when fields are touched (focused and then blurred)
        fullNameInput.addEventListener('blur', function() {
            touchedFields.fullName = true;
            updateNextButton();
        });

        emailInput.addEventListener('blur', function() {
            touchedFields.email = true;
            updateNextButton();
        });

        phoneInput.addEventListener('blur', function() {
            touchedFields.phone = true;
            updateNextButton();
        });

        // Add number-only validation to phone input
        phoneInput.addEventListener('input', function(e) {
            // Remove any non-numeric characters
            let value = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = value;
            updateNextButton();
        });

        // Prevent non-numeric input on keypress
        phoneInput.addEventListener('keypress', function(e) {
            // Allow backspace, delete, tab, escape, enter
            if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                (e.keyCode === 65 && e.ctrlKey === true) ||
                (e.keyCode === 67 && e.ctrlKey === true) ||
                (e.keyCode === 86 && e.ctrlKey === true) ||
                (e.keyCode === 88 && e.ctrlKey === true)) {
                return;
            }
            // Ensure that it is a number and stop the keypress
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });

        // Next button functionality
        nextBtn.addEventListener('click', async function() {
            if (!this.disabled) {
                // Show loading state
                const originalText = this.textContent;
                this.textContent = 'Submitting Order...';
                this.disabled = true;
                
                try {
                    // Store the contact data in localStorage
                    const contactData = {
                        fullName: fullNameInput.value,
                        email: emailInput.value,
                        countryCode: countryCodeSelect.value,
                        phoneNumber: phoneInput.value,
                        pricing: {
                            songFee: SONG_PRICE,
                            total: SONG_PRICE
                        }
                    };
                    localStorage.setItem('contactData', JSON.stringify(contactData));
                    
                    // Navigate to payment page
                    window.location.href = 'create-song-step4.html';
                } catch (error) {
                    // Reset button state on error
                    this.textContent = originalText;
                    this.disabled = false;
                    console.error('Error submitting order:', error);
                }
            }
        });

        // Back button functionality
        document.getElementById('backBtn').addEventListener('click', function() {
            window.location.href = 'create-song-step2.html';
        });

        // Exit modal functionality
        const exitModal = document.getElementById('exitModal');
        const closeBtn = document.getElementById('closeBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelExitBtn = document.getElementById('cancelExitBtn');
        const confirmExitBtn = document.getElementById('confirmExitBtn');

        // Show modal when close button is clicked
        closeBtn.addEventListener('click', function() {
            exitModal.classList.remove('hidden');
        });

        // Close modal when X button is clicked
        closeModalBtn.addEventListener('click', function() {
            exitModal.classList.add('hidden');
        });

        // Cancel exit
        cancelExitBtn.addEventListener('click', function() {
            exitModal.classList.add('hidden');
        });

        // Confirm exit - go back to home
        confirmExitBtn.addEventListener('click', function() {
            // Clear localStorage to reset progress
            localStorage.removeItem('songPreferences');
            localStorage.removeItem('songFormData');
            localStorage.removeItem('contactData');
            // Navigate to home page
            window.location.href = 'index.html';
        });

        // Function to clear all form data
        function clearAllFormData() {
            localStorage.removeItem('songPreferences');
            localStorage.removeItem('songFormData');
            localStorage.removeItem('contactData');
        }

        // Clear form data when clicking logo or navigation links to home
        document.querySelectorAll('a[href="index.html"]').forEach(link => {
            link.addEventListener('click', function(e) {
                clearAllFormData();
            });
        });

        // Close modal when clicking outside
        exitModal.addEventListener('click', function(e) {
            if (e.target === exitModal) {
                exitModal.classList.add('hidden');
            }
        });

        // Supabase configuration
        const supabaseUrl = 'https://lchleopfdvrgunbrlngh.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjaGxlb3BmZHZyZ3VuYnJsbmdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NTYwNjgsImV4cCI6MjA3MzMzMjA2OH0.U4NkKdXFgK3Im78oz_SaEHkWQqGzhlaeA83Rom4oD7A';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Test database connection and setup
        async function testDatabaseConnection() {
            try {
                console.log('Testing database connection...');
                const { data, error } = await supabase
                    .from('song_requests')
                    .select('count')
                    .limit(1);

                if (error) {
                    console.error('Database connection failed:', error);
                    if (error.message.includes('relation "song_requests" does not exist')) {
                        console.log('Table does not exist. Please run the SQL setup script in Supabase.');
                        alert('Database table not found. Please run the setup script in your Supabase dashboard first.');
                        return false;
                    }
                    return false;
                }

                console.log('Database connection successful');
                return true;
            } catch (error) {
                console.error('Database test error:', error);
                return false;
            }
        }

        // Function to save order to Supabase
        async function saveOrderToSupabase(contactData) {
            try {
                console.log('Starting order submission...');
                
                // Get all form data from localStorage
                const songPreferences = JSON.parse(localStorage.getItem('songPreferences') || '{}');
                const songFormData = JSON.parse(localStorage.getItem('songFormData') || '{}');
                
                console.log('Form data collected:', { songPreferences, songFormData, contactData });
                
                // Prepare order data
                const orderData = {
                    customer_name: contactData.fullName,
                    customer_email: contactData.email,
                    customer_phone: contactData.countryCode + contactData.phoneNumber,
                    celebration: songPreferences.celebration,
                    genre: songPreferences.genre,
                    recipient_name: songFormData.recipientName,
                    recipient_gender: songFormData.recipientGender,
                    status: 'pending',
                    price: contactData.pricing.total,
                    created_at: new Date().toISOString()
                };

                console.log('Order data prepared:', orderData);

                // Test database connection first
                const dbConnected = await testDatabaseConnection();
                if (!dbConnected) {
                    throw new Error('Database connection failed. Please check your Supabase setup.');
                }

                // Save to Supabase
                const { data, error } = await supabase
                    .from('song_requests')
                    .insert([orderData])
                    .select();

                if (error) {
                    console.error('Error saving order:', error);
                    throw new Error(`Failed to save order: ${error.message}`);
                }

                console.log('Order saved successfully:', data);
                
                // Clear localStorage after successful submission
                localStorage.removeItem('songPreferences');
                localStorage.removeItem('songFormData');
                localStorage.removeItem('contactData');
                
                // Show success message and redirect
                alert('ðŸŽ‰ Order submitted successfully! You will receive a confirmation email shortly.');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
                
            } catch (error) {
                console.error('Order submission error:', error);
                alert(`Error submitting order: ${error.message}. Please check the console for details.`);
                throw error; // Re-throw to trigger button reset
            }
        }

        // Load saved data when page loads
        function loadSavedData() {
            const savedContactData = localStorage.getItem('contactData');
            if (savedContactData) {
                const contactData = JSON.parse(savedContactData);
                console.log('Loaded contact data:', contactData);
                
                // Populate form fields with saved data
                if (contactData.fullName) {
                    fullNameInput.value = contactData.fullName;
                    touchedFields.fullName = true; // Mark as touched since it has saved data
                }
                if (contactData.email) {
                    emailInput.value = contactData.email;
                    touchedFields.email = true; // Mark as touched since it has saved data
                }
                if (contactData.countryCode) {
                    countryCodeSelect.value = contactData.countryCode;
                }
                if (contactData.phoneNumber) {
                    phoneInput.value = contactData.phoneNumber;
                    touchedFields.phone = true; // Mark as touched since it has saved data
                }
            }
        }

        // Function to update the display of the country code dropdown
        function updateCountryCodeDisplay() {
            const selectedOption = countryCodeSelect.options[countryCodeSelect.selectedIndex];
            if (selectedOption) {
                // Extract just the country code from the option value
                const countryCode = selectedOption.value;
                
                // Create a custom display element
                let customDisplay = countryCodeSelect.parentElement.querySelector('.custom-country-display');
                if (!customDisplay) {
                    customDisplay = document.createElement('div');
                    customDisplay.className = 'custom-country-display';
                    customDisplay.style.position = 'absolute';
                    customDisplay.style.left = '8px';
                    customDisplay.style.top = '50%';
                    customDisplay.style.transform = 'translateY(-50%)';
                    customDisplay.style.pointerEvents = 'none';
                    customDisplay.style.color = '#374151';
                    customDisplay.style.fontSize = '14px';
                    customDisplay.style.zIndex = '10';
                    countryCodeSelect.parentElement.appendChild(customDisplay);
                }
                
                customDisplay.textContent = countryCode;
                
                // Hide the select text by making it transparent
                countryCodeSelect.style.color = 'transparent';
            }
        }

        // Add event listener for country code change
        countryCodeSelect.addEventListener('change', function() {
            updateCountryCodeDisplay();
            updateNextButton();
        });

        // Country detection function
        async function detectAndSetCountryCode() {
            // Only set if no saved data exists (don't override user's previous selection)
            const savedContactData = localStorage.getItem('contactData');
            if (savedContactData) {
                const contactData = JSON.parse(savedContactData);
                if (contactData.countryCode) {
                    return; // Don't override saved country code
                }
            }

            try {
                // Try multiple IP geolocation services for better reliability
                let countryCode = null;
                let countryName = null;
                
                // First try ip-api.com (more reliable)
                try {
                    const response1 = await fetch('http://ip-api.com/json/?fields=status,country,countryCode,query');
                    const data1 = await response1.json();
                    
                    if (data1.status === 'success' && data1.countryCode) {
                        // Map country code to phone code
                        const phoneCodeMap = {
                            'AE': '+971', 'SA': '+966', 'KW': '+965', 'QA': '+974', 'BH': '+973', 'OM': '+968',
                            'US': '+1', 'CA': '+1', 'GB': '+44', 'FR': '+33', 'DE': '+49', 'IT': '+39',
                            'ES': '+34', 'NL': '+31', 'BE': '+32', 'CH': '+41', 'AT': '+43', 'SE': '+46',
                            'NO': '+47', 'DK': '+45', 'FI': '+358', 'PL': '+48', 'CZ': '+420', 'HU': '+36',
                            'RO': '+40', 'BG': '+359', 'HR': '+385', 'SI': '+386', 'SK': '+421', 'LT': '+370',
                            'LV': '+371', 'EE': '+372', 'IE': '+353', 'PT': '+351', 'GR': '+30', 'CY': '+357',
                            'MT': '+356', 'LU': '+352', 'IS': '+354', 'LI': '+423', 'MC': '+377', 'SM': '+378',
                            'VA': '+39', 'AD': '+376', 'RU': '+7', 'UA': '+380', 'BY': '+375', 'MD': '+373',
                            'GE': '+995', 'AM': '+374', 'AZ': '+994', 'KZ': '+7', 'UZ': '+998', 'KG': '+996',
                            'TJ': '+992', 'TM': '+993', 'AF': '+93', 'PK': '+92', 'IN': '+91', 'BD': '+880',
                            'LK': '+94', 'MV': '+960', 'BT': '+975', 'NP': '+977', 'CN': '+86', 'MN': '+976',
                            'KP': '+850', 'KR': '+82', 'JP': '+81', 'TW': '+886', 'HK': '+852', 'MO': '+853',
                            'TH': '+66', 'VN': '+84', 'LA': '+856', 'KH': '+855', 'MY': '+60', 'SG': '+65',
                            'ID': '+62', 'PH': '+95', 'BN': '+673', 'TL': '+670', 'AU': '+61', 'NZ': '+64',
                            'FJ': '+679', 'PG': '+675', 'SB': '+677', 'VU': '+678', 'NC': '+687', 'PF': '+689',
                            'WS': '+685', 'TO': '+676', 'KI': '+686', 'TV': '+688', 'NR': '+674', 'FM': '+691',
                            'MH': '+692', 'PW': '+680', 'CK': '+682', 'NU': '+683', 'TK': '+690', 'AS': '+1',
                            'GU': '+1', 'MP': '+1', 'PR': '+1', 'VI': '+1', 'MX': '+52', 'GT': '+502',
                            'BZ': '+501', 'SV': '+503', 'HN': '+504', 'NI': '+505', 'CR': '+506', 'PA': '+507',
                            'CU': '+53', 'JM': '+1', 'HT': '+509', 'DO': '+1', 'TT': '+1', 'BB': '+1',
                            'AG': '+1', 'DM': '+1', 'GD': '+1', 'KN': '+1', 'LC': '+1', 'VC': '+1',
                            'AR': '+54', 'BO': '+591', 'BR': '+55', 'CL': '+56', 'CO': '+57', 'EC': '+593',
                            'FK': '+500', 'GF': '+594', 'GY': '+592', 'PY': '+595', 'PE': '+51', 'SR': '+597',
                            'UY': '+598', 'VE': '+58', 'ZA': '+27', 'EG': '+20', 'LY': '+218', 'TN': '+216',
                            'DZ': '+213', 'MA': '+212', 'SD': '+249', 'SS': '+211', 'ET': '+251', 'ER': '+291',
                            'DJ': '+253', 'SO': '+252', 'KE': '+254', 'UG': '+256', 'TZ': '+255', 'RW': '+250',
                            'BI': '+257', 'MW': '+265', 'ZM': '+260', 'ZW': '+263', 'BW': '+267', 'NA': '+264',
                            'SZ': '+268', 'LS': '+266', 'MG': '+261', 'MU': '+230', 'SC': '+248', 'KM': '+269',
                            'YT': '+262', 'RE': '+262', 'MZ': '+258', 'AO': '+244', 'CD': '+243', 'CG': '+242',
                            'CF': '+236', 'TD': '+235', 'CM': '+237', 'GQ': '+240', 'GA': '+241', 'ST': '+239',
                            'GH': '+233', 'TG': '+228', 'BJ': '+229', 'NE': '+227', 'BF': '+226', 'ML': '+223',
                            'SN': '+221', 'GM': '+220', 'GN': '+224', 'GW': '+245', 'LR': '+231', 'SL': '+232',
                            'CI': '+225', 'NG': '+234'
                        };
                        
                        countryCode = phoneCodeMap[data1.countryCode];
                        countryName = data1.country;
                        
                        if (countryCode) {
                            const option = countryCodeSelect.querySelector(`option[value="${countryCode}"]`);
                            if (option) {
                                countryCodeSelect.value = countryCode;
                                console.log(`Auto-detected country: ${countryName} (${countryCode})`);
                                return;
                            }
                        }
                    }
                } catch (error) {
                    console.log('ip-api.com failed, trying backup service...');
                }
                
                // Fallback to ipapi.co
                try {
                    const response2 = await fetch('https://ipapi.co/json/');
                    const data2 = await response2.json();
                    
                    if (data2.country_code) {
                        const phoneCode = '+' + data2.country_calling_code;
                        const option = countryCodeSelect.querySelector(`option[value="${phoneCode}"]`);
                        
                        if (option) {
                            countryCodeSelect.value = phoneCode;
                            console.log(`Auto-detected country: ${data2.country_name} (${phoneCode})`);
                            return;
                        }
                    }
                } catch (error) {
                    console.log('ipapi.co also failed');
                }
                
                // If both services fail, use UAE as default
                console.log('All geolocation services failed, using UAE as default');
                countryCodeSelect.value = '+971';
                
            } catch (error) {
                console.log('Could not auto-detect country, using default');
                // Fallback: Set to UAE (most common for this service)
                countryCodeSelect.value = '+971';
            }
        }

        // Initialize function
        async function initialize() {
            calculatePrices();
            loadSavedData();
            await detectAndSetCountryCode(); // Auto-detect country
            updateCountryCodeDisplay(); // Set initial display
            
            // Update button state after loading saved data (this will validate if data exists)
            updateNextButton();
            
            // Test database connection on page load
            testDatabaseConnection();
        }

        // Start initialization
        initialize();
    </script>
</body>
</html>
