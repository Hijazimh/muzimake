<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Data Flow Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        .warning { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 8px;
        }
        button:hover { background: #0056b3; }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        .step {
            background: #e9ecef;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Form Data Flow Test</h1>
        <p>This page tests how data flows between the form steps and displays in the order summary.</p>
        
        <div class="step">
            <h3>Step 1: Check Current localStorage Data</h3>
            <button onclick="checkLocalStorage()">Check localStorage Data</button>
        </div>
        
        <div class="step">
            <h3>Step 2: Simulate Form Data</h3>
            <button onclick="simulateFormData()">Create Test Form Data</button>
        </div>
        
        <div class="step">
            <h3>Step 3: Test Order Summary Display</h3>
            <button onclick="testOrderSummary()">Test Order Summary</button>
        </div>
        
        <div class="step">
            <h3>Step 4: Clear Test Data</h3>
            <button onclick="clearTestData()">Clear localStorage</button>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = `result ${type}`;
            result.textContent = message;
        }

        function checkLocalStorage() {
            const songPreferences = JSON.parse(localStorage.getItem('songPreferences') || '{}');
            const songFormData = JSON.parse(localStorage.getItem('songFormData') || '{}');
            const contactData = JSON.parse(localStorage.getItem('contactData') || '{}');
            
            showResult(`Current localStorage Data:

üìã songPreferences:
${JSON.stringify(songPreferences, null, 2)}

üìù songFormData:
${JSON.stringify(songFormData, null, 2)}

üìû contactData:
${JSON.stringify(contactData, null, 2)}

üîç Analysis:
- songPreferences has: ${Object.keys(songPreferences).length} fields
- songFormData has: ${Object.keys(songFormData).length} fields  
- contactData has: ${Object.keys(contactData).length} fields

${Object.keys(songPreferences).length === 0 ? '‚ö†Ô∏è No song preferences found' : '‚úÖ Song preferences found'}
${Object.keys(songFormData).length === 0 ? '‚ö†Ô∏è No form data found' : '‚úÖ Form data found'}
${Object.keys(contactData).length === 0 ? '‚ö†Ô∏è No contact data found' : '‚úÖ Contact data found'}`);
        }

        function simulateFormData() {
            // Simulate Step 1 data (songPreferences)
            const songPreferences = {
                moment: "Birthday",
                vibe: ["Happy", "Energetic"],
                genre: "Pop",
                gender: "Male"
            };
            
            // Simulate Step 2 data (songFormData)
            const songFormData = {
                name: "John Doe",
                story: "This is a special birthday song for my best friend who loves music and always makes everyone smile."
            };
            
            // Simulate Step 3 data (contactData)
            const contactData = {
                fullName: "Jane Smith",
                email: "jane@example.com",
                countryCode: "+971",
                phoneNumber: "501234567"
            };
            
            // Save to localStorage
            localStorage.setItem('songPreferences', JSON.stringify(songPreferences));
            localStorage.setItem('songFormData', JSON.stringify(songFormData));
            localStorage.setItem('contactData', JSON.stringify(contactData));
            
            showResult(`‚úÖ Test data created and saved to localStorage!

üìã songPreferences:
${JSON.stringify(songPreferences, null, 2)}

üìù songFormData:
${JSON.stringify(songFormData, null, 2)}

üìû contactData:
${JSON.stringify(contactData, null, 2)}

üéØ This simulates a complete form submission.
Now test the order summary to see how this data displays!`);
        }

        function testOrderSummary() {
            // Load data the same way the payment page does
            const songPreferences = JSON.parse(localStorage.getItem('songPreferences') || '{}');
            const songFormData = JSON.parse(localStorage.getItem('songFormData') || '{}');
            const contactData = JSON.parse(localStorage.getItem('contactData') || '{}');

            // Map the data correctly (same as payment page)
            const orderData = {
                // From songPreferences (Step 1)
                moment: songPreferences.moment,
                vibe: songPreferences.vibe,
                genre: songPreferences.genre,
                gender: songPreferences.gender,
                
                // From songFormData (Step 2)
                recipientName: songFormData.name,
                story: songFormData.story,
                
                // From contactData (Step 3)
                fullName: contactData.fullName,
                email: contactData.email,
                countryCode: contactData.countryCode,
                phoneNumber: contactData.phoneNumber,
                
                orderId: 'TEST_' + Date.now()
            };

            // Generate order summary HTML (same as payment page)
            const summaryHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold text-custom-dark mb-2">Song Details</h3>
                        <div class="space-y-1 text-sm text-custom-gray">
                            <p><span class="font-medium">Celebration:</span> ${orderData.moment || 'N/A'}</p>
                            <p><span class="font-medium">Genre:</span> ${orderData.genre || 'N/A'}</p>
                            <p><span class="font-medium">For:</span> ${orderData.recipientName || 'N/A'}</p>
                            <p><span class="font-medium">Gender:</span> ${orderData.gender || 'N/A'}</p>
                            ${orderData.vibe && orderData.vibe.length > 0 ? `<p><span class="font-medium">Vibe:</span> ${Array.isArray(orderData.vibe) ? orderData.vibe.join(', ') : orderData.vibe}</p>` : ''}
                            ${orderData.story ? `<p><span class="font-medium">Story:</span> ${orderData.story.length > 50 ? orderData.story.substring(0, 50) + '...' : orderData.story}</p>` : ''}
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-custom-dark mb-2">Contact Information</h3>
                        <div class="space-y-1 text-sm text-custom-gray">
                            <p><span class="font-medium">Name:</span> ${orderData.fullName || 'N/A'}</p>
                            <p><span class="font-medium">Email:</span> ${orderData.email || 'N/A'}</p>
                            <p><span class="font-medium">Phone:</span> ${orderData.countryCode || ''}${orderData.phoneNumber || 'N/A'}</p>
                        </div>
                    </div>
                </div>
            `;

            showResult(`üéØ Order Summary Test Results:

üìä Mapped Order Data:
${JSON.stringify(orderData, null, 2)}

üìã Order Summary HTML:
${summaryHTML}

‚úÖ Data Flow Analysis:
- Celebration: ${orderData.moment ? '‚úÖ Found' : '‚ùå Missing'}
- Genre: ${orderData.genre ? '‚úÖ Found' : '‚ùå Missing'}
- For: ${orderData.recipientName ? '‚úÖ Found' : '‚ùå Missing'}
- Gender: ${orderData.gender ? '‚úÖ Found' : '‚ùå Missing'}
- Vibe: ${orderData.vibe ? '‚úÖ Found' : '‚ùå Missing'}
- Story: ${orderData.story ? '‚úÖ Found' : '‚ùå Missing'}
- Name: ${orderData.fullName ? '‚úÖ Found' : '‚ùå Missing'}
- Email: ${orderData.email ? '‚úÖ Found' : '‚ùå Missing'}
- Phone: ${orderData.phoneNumber ? '‚úÖ Found' : '‚ùå Missing'}

${Object.values(orderData).filter(v => v && v !== 'N/A').length >= 6 ? 'üéâ Order summary should display correctly!' : '‚ö†Ô∏è Some data is missing - check form submission'}`);
        }

        function clearTestData() {
            localStorage.removeItem('songPreferences');
            localStorage.removeItem('songFormData');
            localStorage.removeItem('contactData');
            
            showResult('üßπ Test data cleared from localStorage!\n\nAll form data has been removed. You can now test with fresh data.');
        }

        // Auto-run on page load
        window.addEventListener('load', function() {
            showResult('Form Data Flow Test Page Loaded\n\nThis page helps debug the data flow between form steps.\n\nClick the buttons above to test each step of the data flow.');
        });
    </script>
</body>
</html>
